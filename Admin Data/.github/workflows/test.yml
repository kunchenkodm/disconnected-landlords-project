name: Test Data Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - uses: r-lib/actions/setup-r@v2
      with:
        r-version: "4.3.0"
        
    - uses: r-lib/actions/setup-renv@v2
    
    - name: Install system dependencies
      run: |
        # Add any system dependencies here
        
    - name: Restore R packages
      run: |
        renv::restore()
      shell: Rscript {0}
      
    - name: Run tests
      run: |
        if (file.exists("tests/run_tests.R")) {
          source("tests/run_tests.R")
        } else {
          message("No tests found - running basic checks")
          # Basic project structure validation
          stopifnot(dir.exists("scripts"))
          stopifnot(dir.exists("data"))
          stopifnot(file.exists("config/config.yml"))
        }
      shell: Rscript {0}

